
## FROM MY OLD SCRIPT ##    

# https://chat.openai.com/share/bc6deb5f-d70c-4cc7-aae4-2fd88a60cab2
# Försök till att sätta allt i en funktion. 


# här finns även ett skript som ska updatera datan.
# https://chat.openai.com/share/e808eb48-de27-4538-ba1b-ea9828aba711

import requests
import configparser






from database_setupV2 import insert_json_data, create_GP_table


base_url = "https://www.space-track.org"
requestLogin  = "/ajaxauth/login"

config = configparser.ConfigParser()
config.read("./ALLdataV2.ini")
configUsr = config.get("configuration","username")
configPwd = config.get("configuration","password")
siteCred = {'identity': configUsr, 'password': configPwd}

satcat_endpointV2 = "/basicspacedata/query/class/satcat/NORAD_CAT_ID/%3E58215/orderby/NORAD_CAT_ID%20asc/emptyresult/show"
Gp_enpoint        =  "/basicspacedata/query/class/gp/NORAD_CAT_ID/%3E58215/orderby/NORAD_CAT_ID%20asc/emptyresult/show"




class MyError(Exception):
    pass

def fetch_data(base_url, requestLogin, siteCred, satcat_endpointV2, Gp_enpoint):
    with requests.Session() as session:
        try:
            # Logging in
            resp = session.post(base_url + requestLogin, data=siteCred)
            if resp.status_code != 200:
                raise MyError(resp, "POST fail on login")

            # Fetch SATCAT data
            resp = session.get(base_url + satcat_endpointV2)
            if resp.status_code != 200:
                print(resp)
                raise MyError(resp, "GET fail on request for SATCATs")
            
            fetched_satcat_data = resp.json()

            # Fetch GP data
            resp = session.get(base_url + Gp_enpoint)
            if resp.status_code != 200:
                print(resp)
                raise MyError(resp, "GET fail on request for GPs")
            
            fetched_GP_data = resp.json()

            # Process the fetched data or insert into a database
            insert_json_data(fetched_satcat_data)
            create_GP_table(fetched_GP_data)
        
        except MyError as e:
            print("Error:", e)
        finally:
            session.close()


fetch_data(base_url, requestLogin, siteCred, satcat_endpointV2, Gp_enpoint)






